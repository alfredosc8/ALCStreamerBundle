<?php
namespace ALC\StreamerBundle\Streamer;

/**
 * A class to provide functionality for getting information about streamer stations.
 *
 * @author Lee Conlin <lee@wildkatz.org>
 */
class StreamerStatus
{
    /**
     * StreamID
     * @var string
     */
    private $streamidv1;

    /**
     * online
     * @var boolean
     */
    private $onlinev1 = false;

    /**
     * Station Name
     * @var string
     */
    private $stationnamev1 = '';

    /**
     * P2P URL
     * @var string
     */
    private $p2purlv1 = '';

    /**
     * Now Playing
     * @var string
     */
    private $nowplayingv1 = '';
    /**
     * StreamID
     * @var string
     */
    private $streamidv2;

    /**
     * online
     * @var boolean
     */
    private $onlinev2 = false;

    /**
     * Station Name
     * @var string
     */
    private $stationnamev2 = '';

    /**
     * P2P URL
     * @var string
     */
    private $p2purlv2 = '';

    /**
     * Now Playing
     * @var string
     */
    private $nowplayingv2 = '';

    /**
     * Default constructor
     *
     * @param string $streamid The StreamID of the station
     */
    public function __construct($streamidv1, $streamidv2)
    {
        if (empty($streamidv1) && empty($streamidv2)) {
            throw new \Exception('Cannot construct class \'\ALC\StreamerBundle\Streamer\StreamerStatus\' without at least 1 stream id.');
        }
        $this->streamidv1 = $streamidv1;
        $this->streamidv2 = $streamidv2;
        $this->fetchInfo();
    }

    /**
     * Retrieves the XML data from streamerp2p.de and caches it in member variables.
     */
    private function fetchInfo()
    {
        if (!empty($this->streamidv1)) {
            $infov1 = simplexml_load_file('http://streamerp2p.de/widget/info.php?id='.$this->streamidv1);
            $this->onlinev1 = $infov1->item->status == 'online'?true:false;
            $this->stationnamev1 = urldecode($infov1->item->stationname);
            $this->nowplayingv1 = urldecode($infov1->item->nowplaying);
            $this->p2purlv1 = urldecode($infov1->item->p2purl);
        }
        if (!empty($this->streamidv2)) {
            $infov2 = simplexml_load_file('http://streamerp2p.de/widget/info.php?id='.$this->streamidv2);
            $this->onlinev2 = $infov2->item->status == 'online'?true:false;
            $this->stationnamev2 = urldecode($infov2->item->stationname);
            $this->nowplayingv2 = urldecode($infov2->item->nowplaying);
            $this->p2purlv2 = urldecode($infov2->item->p2purl);
        }
    }

    /**
     * Gets the online/offline status of a station
     *
     * @return boolean True if station is online, otherwise false.
     */
    public function isV1Online()
    {
        return $this->onlinev1;
    }

    /**
     * Gets the online/offline status of a station
     *
     * @return boolean True if station is online, otherwise false.
     */
    public function isV2Online()
    {
        return $this->onlinev2;
    }

    /**
     * nowPlaying
     *
     * @return string The name of the track now playing on the station
     */
    public function V1NowPlaying()
    {
        return $this->nowplayingv1;
    }

    /**
     * nowPlaying
     *
     * @return string The name of the track now playing on the station
     */
    public function V2NowPlaying()
    {
        return $this->nowplayingv2;
    }

    /**
     * getStreamUrl
     *
     * @return strng A streamerp2p:// application URL to auto-tune to the station
     */
    public function getV1StreamUrl()
    {
        return $this->p2purlv1;
    }

    /**
     * getStreamUrl
     *
     * @return strng A streamerp2p:// application URL to auto-tune to the station
     */
    public function getV2StreamUrl()
    {
        return $this->p2purlv2;
    }
}